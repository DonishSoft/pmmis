@model PMMIS.Domain.Entities.Village
@{
    var jamoat = Model.Jamoat;
    var district = jamoat?.District;
    ViewData["Title"] = $"–°–µ–ª–æ {Model.NameRu}";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-action="Index">–ì–µ–æ–≥—Ä–∞—Ñ–∏—è</a></li>
            <li class="breadcrumb-item"><a asp-action="Jamoats" asp-route-districtId="@district?.Id">@district?.NameRu</a></li>
            <li class="breadcrumb-item"><a asp-action="Villages" asp-route-jamoatId="@jamoat?.Id">@jamoat?.NameRu</a></li>
            <li class="breadcrumb-item active">@Model.NameRu</li>
        </ol>
    </nav>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2>@Model.NameRu <small class="text-muted">(@Model.NameTj)</small></h2>
            <span class="badge bg-secondary">–ó–æ–Ω–∞: @Model.Zone</span>
            @if (Model.IsCoveredByProject)
            {
                <span class="badge bg-success ms-2">–í –æ—Ö–≤–∞—Ç–µ –ø—Ä–æ–µ–∫—Ç–∞</span>
            }
        </div>
        <a asp-action="EditVillage" asp-route-id="@Model.Id" class="btn btn-outline-primary">
            <i class="bi bi-pencil me-1"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
        </a>
    </div>

    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="bi bi-check-circle me-2"></i>@TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="bi bi-exclamation-circle me-2"></i>@TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <!-- Demographics -->
    <div class="row g-4 mb-4">
        <div class="col-md-2">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <h4 class="text-primary mb-0">@Model.PopulationCurrent.ToString("N0")</h4>
                    <small class="text-muted">–ù–∞—Å–µ–ª–µ–Ω–∏–µ (2025)</small>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <h4 class="text-info mb-0">@Model.FemalePopulation.ToString("N0")</h4>
                    <small class="text-muted">–ñ–µ–Ω—â–∏–Ω</small>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <h4 class="text-success mb-0">@Model.HouseholdsCurrent.ToString("N0")</h4>
                    <small class="text-muted">–î–æ–º–æ—Ö–æ–∑—è–π—Å—Ç–≤</small>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <h4 class="text-warning mb-0">@Model.Schools.Count</h4>
                    <small class="text-muted">–®–∫–æ–ª</small>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <h4 class="text-danger mb-0">@Model.HealthFacilities.Count</h4>
                    <small class="text-muted">–ú–µ–¥—É—á—Ä–µ–∂–¥–µ–Ω–∏–π</small>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <!-- Schools Section -->
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="bi bi-mortarboard me-2"></i>–®–∫–æ–ª—ã –∏ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</h5>
                    <a asp-controller="Facilities" asp-action="CreateSchool" asp-route-villageId="@Model.Id" class="btn btn-sm btn-primary">
                        <i class="bi bi-plus"></i> –î–æ–±–∞–≤–∏—Ç—å
                    </a>
                </div>
                <div class="card-body p-0">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>‚Ññ</th>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                <th class="text-end">–£—á–∞—â–∏—Ö—Å—è</th>
                                <th class="text-center">üíß</th>
                                <th class="text-center">üöø</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var school in Model.Schools.OrderBy(s => s.Number))
                            {
                                <tr>
                                    <td>@school.Number</td>
                                    <td>@(school.Name ?? $"–®–∫–æ–ª–∞ ‚Ññ{school.Number}")</td>
                                    <td class="text-end">@school.TotalStudents</td>
                                    <td class="text-center">
                                        @if (school.HasWaterSupply)
                                        {
                                            <i class="bi bi-check-circle-fill text-success"></i>
                                        }
                                        else
                                        {
                                            <i class="bi bi-x-circle-fill text-danger"></i>
                                        }
                                    </td>
                                    <td class="text-center">
                                        @if (school.HasSanitation)
                                        {
                                            <i class="bi bi-check-circle-fill text-success"></i>
                                        }
                                        else
                                        {
                                            <i class="bi bi-x-circle-fill text-danger"></i>
                                        }
                                    </td>
                                    <td class="text-end">
                                        <a asp-controller="Facilities" asp-action="EditSchool" asp-route-id="@school.Id" class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-pencil"></i>
                                        </a>
                                    </td>
                                </tr>
                            }
                            @if (!Model.Schools.Any())
                            {
                                <tr>
                                    <td colspan="6" class="text-center text-muted py-3">
                                        –®–∫–æ–ª—ã –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Health Facilities Section -->
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="bi bi-hospital me-2"></i>–ú–µ–¥–∏—Ü–∏–Ω–∞</h5>
                    <a asp-controller="Facilities" asp-action="CreateHealthFacility" asp-route-villageId="@Model.Id" class="btn btn-sm btn-primary">
                        <i class="bi bi-plus"></i> –î–æ–±–∞–≤–∏—Ç—å
                    </a>
                </div>
                <div class="card-body p-0">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                <th>–¢–∏–ø</th>
                                <th class="text-end">–ü–µ—Ä—Å–æ–Ω–∞–ª</th>
                                <th class="text-center">üíß</th>
                                <th class="text-center">üöø</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var facility in Model.HealthFacilities.OrderBy(h => h.SortOrder))
                            {
                                <tr>
                                    <td>@(facility.Name ?? "–ú–µ–¥—É—á—Ä–µ–∂–¥–µ–Ω–∏–µ")</td>
                                    <td>
                                        @if (facility.Type != null)
                                        {
                                            <span class="badge bg-info">@facility.Type.Name</span>
                                        }
                                        else
                                        {
                                            <span class="text-muted">‚Äî</span>
                                        }
                                    </td>
                                    <td class="text-end">@facility.TotalStaff</td>
                                    <td class="text-center">
                                        @if (facility.HasWaterSupply)
                                        {
                                            <i class="bi bi-check-circle-fill text-success"></i>
                                        }
                                        else
                                        {
                                            <i class="bi bi-x-circle-fill text-danger"></i>
                                        }
                                    </td>
                                    <td class="text-center">
                                        @if (facility.HasSanitation)
                                        {
                                            <i class="bi bi-check-circle-fill text-success"></i>
                                        }
                                        else
                                        {
                                            <i class="bi bi-x-circle-fill text-danger"></i>
                                        }
                                    </td>
                                    <td class="text-end">
                                        <a asp-controller="Facilities" asp-action="EditHealthFacility" asp-route-id="@facility.Id" class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-pencil"></i>
                                        </a>
                                    </td>
                                </tr>
                            }
                            @if (!Model.HealthFacilities.Any())
                            {
                                <tr>
                                    <td colspan="6" class="text-center text-muted py-3">
                                        –ú–µ–¥—É—á—Ä–µ–∂–¥–µ–Ω–∏—è –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
