@model PMMIS.Web.ViewModels.Contracts.ContractReportViewModel
@using PMMIS.Domain.Entities
@{
    ViewData["Title"] = "Contract Monitoring Report";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-action="Index">–ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã</a></li>
            <li class="breadcrumb-item active">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤</li>
        </ol>
    </nav>

    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="mb-1"><i class="bi bi-clipboard-data me-2"></i>Contract Monitoring Report</h2>
            <p class="text-muted mb-0">–î–∞—Ç–∞ –æ—Ç—á—ë—Ç–∞: @Model.ReportDate.ToString("dd.MM.yyyy")</p>
        </div>
        <div class="d-flex gap-2 align-items-center">
            <form method="get" class="d-flex gap-2 align-items-center">
                <select name="projectId" class="form-select form-select-sm" style="width: 250px;" onchange="this.form.submit()">
                    <option value="">–í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã</option>
                    @foreach (var p in Model.Projects)
                    {
                        <option value="@p.Id" selected="@(Model.SelectedProjectId == p.Id)">@p.Code ‚Äî @p.NameRu</option>
                    }
                </select>
            </form>
            <a asp-action="Index" class="btn btn-outline-secondary btn-sm">
                <i class="bi bi-arrow-left me-1"></i>–ù–∞–∑–∞–¥
            </a>
        </div>
    </div>

    <!-- Summary Cards -->
    <div class="row g-3 mb-4">
        <div class="col-md-2">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center py-3">
                    <div class="text-muted small">–í—Å–µ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤</div>
                    <div class="fs-2 fw-bold text-primary">@Model.ProgressSummary.TotalContracts</div>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card border-0 shadow-sm h-100 border-start border-4 border-info">
                <div class="card-body text-center py-3">
                    <div class="text-muted small">–í –ø—Ä–æ—Ü–µ—Å—Å–µ</div>
                    <div class="fs-2 fw-bold text-info">@Model.ProgressSummary.OngoingContracts</div>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card border-0 shadow-sm h-100 border-start border-4 border-success">
                <div class="card-body text-center py-3">
                    <div class="text-muted small">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</div>
                    <div class="fs-2 fw-bold text-success">@Model.ProgressSummary.CompletedContracts</div>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center py-3">
                    <div class="text-muted small">–°—É–º–º–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤</div>
                    <div class="fs-5 fw-bold text-primary">$@Model.ProgressSummary.TotalContractAmount.ToString("N0")</div>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center py-3">
                    <div class="text-muted small">–û–ø–ª–∞—á–µ–Ω–æ</div>
                    <div class="fs-5 fw-bold text-success">$@Model.ProgressSummary.TotalPaidAmount.ToString("N0")</div>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-body text-center py-3">
                    <div class="text-muted small">–°—Ä. –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
                    <div class="fs-5 fw-bold text-info">@Model.ProgressSummary.AverageWorkCompleted.ToString("N1")%</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Accordion with 6 tables -->
    <div class="accordion" id="reportAccordion">

        <!-- Table 1: On-Going Procurement Processing -->
        <div class="accordion-item border-0 shadow-sm mb-3">
            <h2 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#table1">
                    <i class="bi bi-hourglass-split me-2 text-warning"></i>
                    <strong>1. On-Going Procurement Processing</strong>
                    <span class="badge bg-warning text-dark ms-2">@Model.OnGoingProcurements.Count</span>
                </button>
            </h2>
            <div id="table1" class="accordion-collapse collapse show" data-bs-parent="#reportAccordion">
                <div class="accordion-body p-0">
                    @if (Model.OnGoingProcurements.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-hover table-sm mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="ps-3">‚Ññ</th>
                                        <th>Ref. No</th>
                                        <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                        <th>–ú–µ—Ç–æ–¥</th>
                                        <th>–¢–∏–ø</th>
                                        <th class="text-end">–û—Ü–µ–Ω–æ—á–Ω–∞—è —Å—É–º–º–∞</th>
                                        <th>–î–∞—Ç–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏—è</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{ var idx1 = 0; }
                                    @foreach (var pp in Model.OnGoingProcurements)
                                    {
                                        idx1++;
                                        <tr>
                                            <td class="ps-3">@idx1</td>
                                            <td><strong>@pp.ReferenceNo</strong></td>
                                            <td>@pp.Description</td>
                                            <td><span class="badge bg-secondary">@pp.Method</span></td>
                                            <td>@pp.Type</td>
                                            <td class="text-end fw-bold">$@pp.EstimatedAmount.ToString("N0")</td>
                                            <td>@(pp.AdvertisementDate?.ToString("dd.MM.yyyy") ?? "‚Äî")</td>
                                            <td>
                                                @{
                                                    var procBadge = pp.Status switch
                                                    {
                                                        ProcurementStatus.InProgress => ("bg-primary", "‚è≥ –í –ø—Ä–æ—Ü–µ—Å—Å–µ"),
                                                        ProcurementStatus.Evaluation => ("bg-info", "üìã –û—Ü–µ–Ω–∫–∞"),
                                                        _ => ("bg-secondary", pp.Status.ToString())
                                                    };
                                                }
                                                <span class="badge @procBadge.Item1">@procBadge.Item2</span>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="text-center text-muted py-4">
                            <i class="bi bi-check-circle fs-3 d-block mb-2"></i>
                            –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫—É–ø–æ–∫ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Table 2: Contracted Activities -->
        <div class="accordion-item border-0 shadow-sm mb-3">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#table2">
                    <i class="bi bi-file-earmark-check me-2 text-primary"></i>
                    <strong>2. Contracted Activities</strong>
                    <span class="badge bg-primary ms-2">@Model.ContractedActivities.Count</span>
                </button>
            </h2>
            <div id="table2" class="accordion-collapse collapse" data-bs-parent="#reportAccordion">
                <div class="accordion-body p-0">
                    @if (Model.ContractedActivities.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-hover table-sm mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="ps-3">‚Ññ</th>
                                        <th>–ö–æ–Ω—Ç—Ä–∞–∫—Ç</th>
                                        <th>–ü–æ–¥—Ä—è–¥—á–∏–∫</th>
                                        <th>–¢–∏–ø</th>
                                        <th class="text-end">–°—É–º–º–∞</th>
                                        <th class="text-end">–û–ø–ª–∞—á–µ–Ω–æ</th>
                                        <th>–ü–æ–¥–ø–∏—Å–∞–Ω–∏–µ</th>
                                        <th>–°—Ä–æ–∫</th>
                                        <th>–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</th>
                                        <th>–°—Ç–∞—Ç—É—Å</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{ var idx2 = 0; }
                                    @foreach (var c in Model.ContractedActivities)
                                    {
                                        idx2++;
                                        var daysLeft = c.RemainingDays;
                                        var daysClass = daysLeft < 0 ? "text-danger" : daysLeft < 30 ? "text-warning" : "text-success";
                                        <tr>
                                            <td class="ps-3">@idx2</td>
                                            <td>
                                                <a asp-action="Details" asp-route-id="@c.Id" class="text-decoration-none fw-bold">
                                                    @c.ContractNumber
                                                </a>
                                            </td>
                                            <td>@c.Contractor.Name</td>
                                            <td>
                                                @{
                                                    var typeIcon = c.Type switch
                                                    {
                                                        ContractType.Works => "üèóÔ∏è",
                                                        ContractType.Consulting => "üíº",
                                                        ContractType.Goods => "üì¶",
                                                        _ => "üìÑ"
                                                    };
                                                }
                                                @typeIcon
                                            </td>
                                            <td class="text-end">$@c.FinalAmount.ToString("N0")</td>
                                            <td class="text-end text-success">$@c.PaidAmount.ToString("N0")</td>
                                            <td>@c.SigningDate.ToString("dd.MM.yyyy")</td>
                                            <td class="@daysClass fw-bold">
                                                @if (daysLeft < 0)
                                                {
                                                    <span>@Math.Abs(daysLeft) –¥–Ω. –ø—Ä–æ—Å—Ä–æ—á–∫–∏</span>
                                                }
                                                else
                                                {
                                                    <span>@daysLeft –¥–Ω.</span>
                                                }
                                            </td>
                                            <td>
                                                <div class="d-flex align-items-center gap-1">
                                                    <div class="progress" style="width: 60px; height: 6px;">
                                                        <div class="progress-bar bg-info" style="width: @c.WorkCompletedPercent%"></div>
                                                    </div>
                                                    <small>@c.WorkCompletedPercent.ToString("N0")%</small>
                                                </div>
                                            </td>
                                            <td>
                                                @{
                                                    var sBadge = c.Status switch
                                                    {
                                                        ContractStatus.Ongoing => ("bg-primary", "üîÑ"),
                                                        ContractStatus.DefectLiability => ("bg-info", "üõ°Ô∏è"),
                                                        _ => ("bg-secondary", "‚Äî")
                                                    };
                                                }
                                                <span class="badge @sBadge.Item1">@sBadge.Item2</span>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                                <tfoot class="table-light">
                                    <tr class="fw-bold">
                                        <td class="ps-3" colspan="4">–ò—Ç–æ–≥–æ</td>
                                        <td class="text-end">$@Model.ContractedActivities.Sum(c => c.FinalAmount).ToString("N0")</td>
                                        <td class="text-end text-success">$@Model.ContractedActivities.Sum(c => c.PaidAmount).ToString("N0")</td>
                                        <td colspan="4"></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="text-center text-muted py-4">
                            <i class="bi bi-inbox fs-3 d-block mb-2"></i>
                            –ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Table 3: Activities Not Commenced / Pending Readiness -->
        <div class="accordion-item border-0 shadow-sm mb-3">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#table3">
                    <i class="bi bi-pause-circle me-2 text-secondary"></i>
                    <strong>3. Activities Not Commenced / Pending Readiness</strong>
                    <span class="badge bg-secondary ms-2">@Model.NotCommencedActivities.Count</span>
                </button>
            </h2>
            <div id="table3" class="accordion-collapse collapse" data-bs-parent="#reportAccordion">
                <div class="accordion-body p-0">
                    @if (Model.NotCommencedActivities.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-hover table-sm mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="ps-3">‚Ññ</th>
                                        <th>Ref. No</th>
                                        <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                        <th>–¢–∏–ø</th>
                                        <th class="text-end">–û—Ü–µ–Ω–æ—á–Ω–∞—è —Å—É–º–º–∞</th>
                                        <th>–ü–ª–∞–Ω–æ–≤–∞—è –¥–∞—Ç–∞ —Ç–µ–Ω–¥–µ—Ä–∞</th>
                                        <th>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{ var idx3 = 0; }
                                    @foreach (var pp in Model.NotCommencedActivities)
                                    {
                                        idx3++;
                                        <tr>
                                            <td class="ps-3">@idx3</td>
                                            <td><strong>@pp.ReferenceNo</strong></td>
                                            <td>@pp.Description</td>
                                            <td>@pp.Type</td>
                                            <td class="text-end">$@pp.EstimatedAmount.ToString("N0")</td>
                                            <td>@(pp.PlannedBidOpeningDate?.ToString("dd.MM.yyyy") ?? "‚Äî")</td>
                                            <td class="text-muted">@(pp.Comments ?? "‚Äî")</td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="text-center text-muted py-4">
                            <i class="bi bi-check-all fs-3 d-block mb-2"></i>
                            –í—Å–µ –∑–∞–∫—É–ø–∫–∏ –Ω–∞—á–∞—Ç—ã
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Table 4: Completed Activities -->
        <div class="accordion-item border-0 shadow-sm mb-3">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#table4">
                    <i class="bi bi-check-circle me-2 text-success"></i>
                    <strong>4. Completed Activities</strong>
                    <span class="badge bg-success ms-2">@Model.CompletedActivities.Count</span>
                </button>
            </h2>
            <div id="table4" class="accordion-collapse collapse" data-bs-parent="#reportAccordion">
                <div class="accordion-body p-0">
                    @if (Model.CompletedActivities.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-hover table-sm mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="ps-3">‚Ññ</th>
                                        <th>–ö–æ–Ω—Ç—Ä–∞–∫—Ç</th>
                                        <th>–ü–æ–¥—Ä—è–¥—á–∏–∫</th>
                                        <th>–¢–∏–ø</th>
                                        <th class="text-end">–°—É–º–º–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞</th>
                                        <th class="text-end">–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Å—É–º–º–∞</th>
                                        <th>–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è</th>
                                        <th>–û—Ü–µ–Ω–∫–∞</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{ var idx4 = 0; }
                                    @foreach (var c in Model.CompletedActivities)
                                    {
                                        idx4++;
                                        <tr>
                                            <td class="ps-3">@idx4</td>
                                            <td>
                                                <a asp-action="Details" asp-route-id="@c.Id" class="text-decoration-none fw-bold">
                                                    @c.ContractNumber
                                                </a>
                                            </td>
                                            <td>@c.Contractor.Name</td>
                                            <td>
                                                @{
                                                    var typeIcon4 = c.Type switch
                                                    {
                                                        ContractType.Works => "üèóÔ∏è",
                                                        ContractType.Consulting => "üíº",
                                                        ContractType.Goods => "üì¶",
                                                        _ => "üìÑ"
                                                    };
                                                }
                                                @typeIcon4
                                            </td>
                                            <td class="text-end">$@c.FinalAmount.ToString("N0")</td>
                                            <td class="text-end text-success fw-bold">$@c.PaidAmount.ToString("N0")</td>
                                            <td>@(c.ActualCompletionDate?.ToString("dd.MM.yyyy") ?? "‚Äî")</td>
                                            <td>
                                                @if (c.PerformanceRating.HasValue)
                                                {
                                                    var rBadge = c.PerformanceRating.Value switch
                                                    {
                                                        PerformanceRating.HighlySatisfactory => ("bg-success", "‚≠ê HS"),
                                                        PerformanceRating.Satisfactory => ("bg-primary", "‚úÖ S"),
                                                        PerformanceRating.Unsatisfactory => ("bg-danger", "‚ö†Ô∏è U"),
                                                        _ => ("bg-secondary", "‚Äî")
                                                    };
                                                    <span class="badge @rBadge.Item1">@rBadge.Item2</span>
                                                }
                                                else
                                                {
                                                    <span class="text-muted">‚Äî</span>
                                                }
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                                <tfoot class="table-light">
                                    <tr class="fw-bold">
                                        <td class="ps-3" colspan="4">–ò—Ç–æ–≥–æ</td>
                                        <td class="text-end">$@Model.CompletedActivities.Sum(c => c.FinalAmount).ToString("N0")</td>
                                        <td class="text-end text-success">$@Model.CompletedActivities.Sum(c => c.PaidAmount).ToString("N0")</td>
                                        <td colspan="2"></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="text-center text-muted py-4">
                            <i class="bi bi-hourglass fs-3 d-block mb-2"></i>
                            –ù–µ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Table 5: Progress Summary -->
        <div class="accordion-item border-0 shadow-sm mb-3">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#table5">
                    <i class="bi bi-bar-chart me-2 text-info"></i>
                    <strong>5. Progress Summary</strong>
                </button>
            </h2>
            <div id="table5" class="accordion-collapse collapse" data-bs-parent="#reportAccordion">
                <div class="accordion-body">
                    <div class="row g-4">
                        <div class="col-md-6">
                            <table class="table table-bordered">
                                <thead class="table-light">
                                    <tr><th colspan="2">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td>–í—Å–µ–≥–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤</td><td class="text-end fw-bold">@Model.ProgressSummary.TotalContracts</td></tr>
                                    <tr><td>üîÑ –í –ø—Ä–æ—Ü–µ—Å—Å–µ / üõ°Ô∏è –ì–∞—Ä–∞–Ω—Ç–∏–π–Ω—ã–π</td><td class="text-end fw-bold text-primary">@Model.ProgressSummary.OngoingContracts</td></tr>
                                    <tr><td>‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ</td><td class="text-end fw-bold text-success">@Model.ProgressSummary.CompletedContracts</td></tr>
                                    <tr><td>‚è∏Ô∏è –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</td><td class="text-end fw-bold text-warning">@Model.ProgressSummary.SuspendedContracts</td></tr>
                                    <tr><td>‚ùå –†–∞—Å—Ç–æ—Ä–≥–Ω—É—Ç–æ</td><td class="text-end fw-bold text-danger">@Model.ProgressSummary.TerminatedContracts</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-bordered">
                                <thead class="table-light">
                                    <tr><th colspan="2">–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å–≤–æ–¥–∫–∞</th></tr>
                                </thead>
                                <tbody>
                                    <tr><td>–û–±—â–∞—è —Å—É–º–º–∞ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤</td><td class="text-end fw-bold">$@Model.ProgressSummary.TotalContractAmount.ToString("N0")</td></tr>
                                    <tr><td>–û–±—â–∞—è —Å—É–º–º–∞ –æ–ø–ª–∞—Ç</td><td class="text-end fw-bold text-success">$@Model.ProgressSummary.TotalPaidAmount.ToString("N0")</td></tr>
                                    <tr>
                                        <td>–°—Ä–µ–¥–Ω–∏–π % –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</td>
                                        <td class="text-end">
                                            <div class="d-flex align-items-center justify-content-end gap-2">
                                                <div class="progress" style="width: 80px; height: 8px;">
                                                    <div class="progress-bar bg-info" style="width: @Model.ProgressSummary.AverageWorkCompleted%"></div>
                                                </div>
                                                <strong>@Model.ProgressSummary.AverageWorkCompleted.ToString("N1")%</strong>
                                            </div>
                                        </td>
                                    </tr>
                                    @{
                                        var paymentRate = Model.ProgressSummary.TotalContractAmount > 0
                                            ? (Model.ProgressSummary.TotalPaidAmount / Model.ProgressSummary.TotalContractAmount * 100)
                                            : 0;
                                    }
                                    <tr>
                                        <td>–û—Å–≤–æ–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤</td>
                                        <td class="text-end">
                                            <div class="d-flex align-items-center justify-content-end gap-2">
                                                <div class="progress" style="width: 80px; height: 8px;">
                                                    <div class="progress-bar bg-success" style="width: @paymentRate%"></div>
                                                </div>
                                                <strong>@paymentRate.ToString("N1")%</strong>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Table 6: Summary by Category -->
        <div class="accordion-item border-0 shadow-sm mb-3">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#table6">
                    <i class="bi bi-pie-chart me-2 text-purple"></i>
                    <strong>6. Summary by Category</strong>
                </button>
            </h2>
            <div id="table6" class="accordion-collapse collapse" data-bs-parent="#reportAccordion">
                <div class="accordion-body p-0">
                    @if (Model.CategorySummaries.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="ps-3">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                        <th class="text-center">–ö–æ–Ω—Ç—Ä–∞–∫—Ç–æ–≤</th>
                                        <th class="text-end">–û–±—â–∞—è —Å—É–º–º–∞</th>
                                        <th class="text-end">–û–ø–ª–∞—á–µ–Ω–æ</th>
                                        <th class="text-end">% –æ—Å–≤–æ–µ–Ω–∏—è</th>
                                        <th>–°—Ä. –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var cs in Model.CategorySummaries)
                                    {
                                        var absorptionRate = cs.TotalAmount > 0 ? (cs.PaidAmount / cs.TotalAmount * 100) : 0;
                                        <tr>
                                            <td class="ps-3 fw-bold">@cs.CategoryName</td>
                                            <td class="text-center">@cs.Count</td>
                                            <td class="text-end">$@cs.TotalAmount.ToString("N0")</td>
                                            <td class="text-end text-success">$@cs.PaidAmount.ToString("N0")</td>
                                            <td class="text-end">@absorptionRate.ToString("N1")%</td>
                                            <td>
                                                <div class="d-flex align-items-center gap-1">
                                                    <div class="progress" style="width: 60px; height: 6px;">
                                                        <div class="progress-bar bg-info" style="width: @cs.AverageCompletion%"></div>
                                                    </div>
                                                    <small>@cs.AverageCompletion.ToString("N0")%</small>
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                                <tfoot class="table-light">
                                    <tr class="fw-bold">
                                        <td class="ps-3">–ò—Ç–æ–≥–æ</td>
                                        <td class="text-center">@Model.CategorySummaries.Sum(cs => cs.Count)</td>
                                        <td class="text-end">$@Model.CategorySummaries.Sum(cs => cs.TotalAmount).ToString("N0")</td>
                                        <td class="text-end text-success">$@Model.CategorySummaries.Sum(cs => cs.PaidAmount).ToString("N0")</td>
                                        <td colspan="2"></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    }
                    else
                    {
                        <div class="text-center text-muted py-4">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</div>
                    }
                </div>
            </div>
        </div>

    </div>
</div>
