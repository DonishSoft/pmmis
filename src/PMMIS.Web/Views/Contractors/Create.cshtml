@model PMMIS.Domain.Entities.Contractor
@using PMMIS.Domain.Entities
@{
    ViewData["Title"] = "–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ä—è–¥—á–∏–∫–∞";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid">
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a asp-action="Index">–ü–æ–¥—Ä—è–¥—á–∏–∫–∏</a></li>
            <li class="breadcrumb-item active">–î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥—Ä—è–¥—á–∏–∫–∞</li>
        </ol>
    </nav>

    <div class="row">
        <div class="col-lg-10">
            <form asp-action="Create" method="post" enctype="multipart/form-data">
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white">
                        <h5 class="card-title mb-0"><i class="bi bi-plus-circle me-2"></i>–ù–æ–≤—ã–π –ø–æ–¥—Ä—è–¥—á–∏–∫</h5>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-8">
                                <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ <span class="text-danger">*</span></label>
                                <input asp-for="Name" class="form-control" placeholder="–û–û–û –°—Ç—Ä–æ–∏—Ç–µ–ª—å" required />
                                <span asp-validation-for="Name" class="text-danger"></span>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">–°—Ç—Ä–∞–Ω–∞</label>
                                <input asp-for="Country" class="form-control" placeholder="–¢–∞–¥–∂–∏–∫–∏—Å—Ç–∞–Ω" />
                            </div>
                        </div>

                        <hr class="my-4" />
                        <h6 class="text-muted mb-3"><i class="bi bi-person-lines-fill me-2"></i>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h6>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label">–ö–æ–Ω—Ç–∞–∫—Ç–Ω–æ–µ –ª–∏—Ü–æ</label>
                                <input asp-for="ContactPerson" class="form-control" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Email</label>
                                <input asp-for="Email" type="email" class="form-control" placeholder="info@company.tj" />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                                <input asp-for="Phone" class="form-control" placeholder="+992 XX XXX-XX-XX" />
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">–ê–¥—Ä–µ—Å</label>
                                <input asp-for="Address" class="form-control" placeholder="–≥. –î—É—à–∞–Ω–±–µ, —É–ª. ..." />
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Documents Section -->
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                        <h5 class="mb-0"><i class="bi bi-folder2-open me-2"></i>–î–æ–∫—É–º–µ–Ω—Ç—ã –∫–æ–º–ø–∞–Ω–∏–∏</h5>
                        <button type="button" class="btn btn-sm btn-outline-success" onclick="addDocRow()">
                            <i class="bi bi-plus-lg me-1"></i>–î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="docContainer"></div>
                        <div id="noDocsMsg" class="text-center text-muted py-3">
                            <i class="bi bi-file-earmark-plus fs-4 d-block mb-2"></i>
                            –ù–∞–∂–º–∏—Ç–µ ¬´–î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç¬ª —á—Ç–æ–±—ã –ø—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Ñ–∞–π–ª—ã
                        </div>
                    </div>
                </div>

                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-lg me-1"></i> –°–æ–∑–¥–∞—Ç—å
                    </button>
                    <a asp-action="Index" class="btn btn-outline-secondary">–û—Ç–º–µ–Ω–∞</a>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
<script>
    let docIndex = 0;

    function addDocRow() {
        document.getElementById('noDocsMsg').style.display = 'none';
        const container = document.getElementById('docContainer');
        const row = document.createElement('div');
        row.className = 'card border mb-3 doc-upload-row';
        const idx = docIndex++;
        row.innerHTML = `
            <div class="card-body py-2 px-3">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <small class="text-muted fw-semibold">–î–æ–∫—É–º–µ–Ω—Ç ${idx + 1}</small>
                    <button type="button" class="btn btn-sm btn-outline-danger border-0" onclick="removeDocRow(this)" title="–£–¥–∞–ª–∏—Ç—å">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
                <div class="row g-2 align-items-center">
                    <div class="col-md-3">
                        <label class="form-label mb-0 small text-muted">–¢–∏–ø</label>
                        <select name="DocTypes" class="form-select form-select-sm" required>
                            <option value="">‚Äî –¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç–∞ ‚Äî</option>
                            <option value="${@((int)DocumentType.CompanyRegistration)}">üìÑ –°–≤–∏–¥. —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</option>
                            <option value="${@((int)DocumentType.CompanyLicense)}">üìú –õ–∏—Ü–µ–Ω–∑–∏—è</option>
                            <option value="${@((int)DocumentType.TaxCertificate)}">üèõÔ∏è –ù–∞–ª–æ–≥–æ–≤—ã–π —Å–µ—Ä—Ç.</option>
                            <option value="${@((int)DocumentType.BankDetails)}">üè¶ –ë–∞–Ω–∫. —Ä–µ–∫–≤–∏–∑–∏—Ç—ã</option>
                            <option value="${@((int)DocumentType.Insurance)}">üõ°Ô∏è –°—Ç—Ä–∞—Ö–æ–≤–∫–∞</option>
                            <option value="${@((int)DocumentType.Contract)}">üìë –ö–æ–Ω—Ç—Ä–∞–∫—Ç</option>
                            <option value="${@((int)DocumentType.TenderDocument)}">üìã –¢–µ–Ω–¥–µ—Ä</option>
                            <option value="${@((int)DocumentType.Report)}">üìä –û—Ç—á—ë—Ç</option>
                            <option value="${@((int)DocumentType.Other)}">üìé –ü—Ä–æ—á–µ–µ</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label mb-0 small text-muted">–§–∞–π–ª</label>
                        <input type="file" name="DocFiles" class="form-control form-control-sm doc-file-input"
                               accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png" required />
                    </div>
                    <div class="col-md-3">
                        <label class="form-label mb-0 small text-muted">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" name="DocNames" class="form-control form-control-sm doc-name-input" placeholder="–ê–≤—Ç–æ –∏–∑ —Ñ–∞–π–ª–∞" />
                    </div>
                    <div class="col-md-2">
                        <label class="form-label mb-0 small text-muted">–ü–æ—Ä—è–¥–æ–∫</label>
                        <input type="number" name="DocSortOrders" class="form-control form-control-sm" value="${idx + 1}" min="0" />
                    </div>
                </div>
            </div>
        `;
        container.appendChild(row);

        // Auto-fill name from file
        const fileInput = row.querySelector('.doc-file-input');
        const nameInput = row.querySelector('.doc-name-input');
        fileInput.addEventListener('change', function() {
            if (!nameInput.value && this.files.length > 0) {
                var fn = this.files[0].name;
                var dot = fn.lastIndexOf('.');
                if (dot > 0) fn = fn.substring(0, dot);
                nameInput.value = fn;
            }
        });
    }

    function removeDocRow(btn) {
        btn.closest('.doc-upload-row').remove();
        if (document.querySelectorAll('.doc-upload-row').length === 0) {
            document.getElementById('noDocsMsg').style.display = '';
        }
    }
</script>
}
